var form = $('div[data-crud-form]');
$('.error', form).remove();
<% if @zone.errors.any? %>
  var errors = <%= raw @zone.errors.to_json %>;
  for (var field in errors) {
    $('#zone_' + field, form).parents('tr:first').before('<tr class="error"><td colspan="2">' + errors[field] + '</td></tr>');
  }
<% else %>
  var new_row = $('<%= escape_javascript render(@zone) %>');
  new_row.find('td').addClass("ui-widget-content");
  // dla stref z wybranym interfejsem usuwamo go z nich
  <% if !@zone.interface.blank? %>
    var $int = $('div.zone table#add-destination tr[data-object]').filter(function() {
      return $(this).data('object').interface == "<%= @zone.interface %>";
    });
    if ($int.length) {
      $int.data('object').interface = '';
      $int.find('td:last').text('');
    }
  <% end %>
  // jeśli ustawiony old_name to znaczy że edycja i w takim wypadku podmieniamy zawartość
  var $old = $('div.zone table#add-destination tr[data-object]').filter(function () {
    return $(this).data('object').name == '<%= @zone.old_name %>'
  })
  if ($old.length) {
    $old.replaceWith(new_row)
  } else {
    $('div.zone table#add-destination').append(new_row);
  }
  form.dialog('close');
<% end %>
